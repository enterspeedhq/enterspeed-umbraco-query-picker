{"version":3,"file":"enterspeed-query-picker.element-OfLG1-U6.js","sources":["../../../Client/src/property-editors/enterspeed-query-picker.element.ts"],"sourcesContent":["import { LitElement, html, css, customElement, property, state } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbPropertyEditorUiElement } from \"@umbraco-cms/backoffice/property-editor\";\r\nimport { UmbPropertyValueChangeEvent } from \"@umbraco-cms/backoffice/property-editor\";\r\nimport { type UmbPropertyEditorConfigCollection } from \"@umbraco-cms/backoffice/property-editor\";\r\nimport { UMB_NOTIFICATION_CONTEXT, UmbNotificationContext } from \"@umbraco-cms/backoffice/notification\";\r\nimport { UmbElementMixin } from \"@umbraco-cms/backoffice/element-api\";\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from \"@umbraco-cms/backoffice/modal\";\r\n\r\n@customElement('enterspeed-query-picker-property-editor-ui')\r\nexport default class EnterspeedQueryPickerPropertyEditorUIElement extends UmbElementMixin((LitElement)) implements UmbPropertyEditorUiElement {\r\n    _modalManagerContext?: typeof UMB_MODAL_MANAGER_CONTEXT.TYPE;\r\n    _notificationContext?: UmbNotificationContext;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => {\r\n            this._modalManagerContext = instance;\r\n        });\r\n    \r\n        this.consumeContext(UMB_NOTIFICATION_CONTEXT, (instance) => {\r\n            this._notificationContext = instance;\r\n        });\r\n\r\n        document.addEventListener('click', this.#onclickOutsideResult.bind(this));\r\n    }\r\n\r\n    @property({ type: String })\r\n    public value = \"\";\r\n\r\n    @property({ attribute: false })\r\n    public set config(config: UmbPropertyEditorConfigCollection) {\r\n      this._enterspeedEnvironmentClient = config.getValueByAlias(\"enterspeedEnvironmentClient\") ?? \"\";\r\n      this._enterspeedIndex = config.getValueByAlias(\"enterspeedIndex\") ?? \"\";\r\n      this._enterspeedQueryField = config.getValueByAlias(\"enterspeedQueryField\") ?? \"\";\r\n      this._enterspeedResultValueField = config.getValueByAlias(\"enterspeedResultValueField\") ?? \"\";\r\n      this._enterspeedResultDisplayField = config.getValueByAlias(\"enterspeedResultDisplayField\") ?? \"\";\r\n      this._enterspeedQueryFieldPlaceholderText = config.getValueByAlias(\"enterspeedQueryFieldPlaceholderText\") ?? \"\";\r\n    }\r\n\r\n    @state()\r\n    private _enterspeedEnvironmentClient: string = \"\";\r\n\r\n    @state()\r\n    private _enterspeedIndex: string = \"\";\r\n\r\n    @state()\r\n    private _enterspeedQueryField: string = \"\";\r\n\r\n    @state()\r\n    private _enterspeedResultValueField: string = \"\";\r\n\r\n    @state()\r\n    private _enterspeedResultDisplayField: string = \"\";\r\n\r\n    @state()\r\n    private _enterspeedQueryFieldPlaceholderText: string = \"\";\r\n\r\n    @state()\r\n    private _queryValue: string = \"\";\r\n\r\n    @state()\r\n    private _queryResult: Option[] = [];\r\n\r\n    @state()\r\n    private _showResults: boolean = false;\r\n\r\n    #onQuery(e: InputEvent) {\r\n      this._queryValue = (e.target as HTMLInputElement).value;\r\n\r\n      if(this._queryValue === \"\") {\r\n        this._queryResult = [];\r\n        return;\r\n      }\r\n\r\n      const query = {\r\n        filters: {},\r\n        pagination: {\r\n          page: 0,\r\n          pageSize: 5\r\n        }\r\n      } as {\r\n        filters: {[key: string] : {}}\r\n      };\r\n\r\n      query.filters[this._enterspeedQueryField] = {\r\n        operator: \"contains\",\r\n        value: `*${this._queryValue}*`\r\n      };\r\n\r\n      (async () => {\r\n        const rawResponse = await fetch(`https://query.dev.enterspeed.io/v1-preview/${this._enterspeedIndex}`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'X-Api-Key': `${this._enterspeedEnvironmentClient}`,\r\n          },\r\n          body: JSON.stringify(query)\r\n        });\r\n\r\n        const content = await rawResponse.json();\r\n\r\n        this._queryResult = \r\n        content\r\n        .results.map((result: {[key: string] : any}) => {\r\n          return {\r\n            name: `${result[this._enterspeedResultValueField]}${this._enterspeedResultDisplayField !== \"\" ? ` - ${result[this._enterspeedResultDisplayField]}` : \"\"}`,\r\n            value: result[this._enterspeedResultValueField]\r\n          }\r\n        })\r\n\r\n        this._showResults = true;\r\n      })();\r\n    }\r\n\r\n    #onClickResult(e: Event, result: Option) {\r\n      e.stopPropagation();\r\n\r\n      this._queryValue = \"\";\r\n      this._queryResult = [];\r\n      this._showResults = false;\r\n      this.value = result.value;\r\n      this.#dispatchChangeEvent();\r\n    }\r\n\r\n    #onClearValue() {\r\n      this.value = \"\";\r\n      \r\n      this.#dispatchChangeEvent();\r\n    }\r\n\r\n    #onclickOutsideResult(e: Event){   \r\n      if (!document.getElementById('result-wrapper')?.contains(e.target as Node)) {\r\n        this._showResults = false;\r\n      }\r\n    }\r\n\r\n    #onValueChange(e: InputEvent) {\r\n      this.value = (e.target as HTMLInputElement).value;\r\n      this.#dispatchChangeEvent();\r\n    }\r\n  \r\n    #dispatchChangeEvent() {\r\n      this.dispatchEvent(new UmbPropertyValueChangeEvent());\r\n    }\r\n\r\n    render() {\r\n        return html`\r\n          <uui-input\r\n          class=\"element\"\r\n          label=\"text input\"\r\n          placeholder=${this._enterspeedQueryFieldPlaceholderText}\r\n          .value=${this._queryValue}\r\n          @input=${this.#onQuery}\r\n        >\r\n        </uui-input>\r\n        \r\n        ${this._showResults ?\r\n          html`\r\n            <uui-box id=\"result-wrapper\">\r\n            ${this._queryResult.length > 0 ?\r\n              html`\r\n                  <uui-ref-list>\r\n                    ${this._queryResult.map((result) =>\r\n                      html`<uui-ref-node name=\"${result.name}\"\r\n                        class=\"result\"\r\n                        readonly\r\n                        ?selectable=${false}\r\n                        @click=${(event: Event) => this.#onClickResult(event, result)}\r\n                      >\r\n\t\t\t\t\t\t\t\t\t      <umb-icon slot=\"icon\" name=\"\"></umb-icon>\r\n                      </uui-ref-node>`\r\n                    )}\r\n                  </uui-ref-list>`:\r\n              html`\r\n                <uui-ref-list>\r\n                  <uui-ref-node name=\"No results\"\r\n                        readonly\r\n                        ?selectable=${false}\r\n                  >\r\n\t\t\t\t\t\t\t\t\t      <umb-icon slot=\"icon\" name=\"\"></umb-icon>\r\n                  </uui-ref-node>\r\n                </uui-ref-list>\r\n              `\r\n            }\r\n            </uui-box>`:\r\n          html``\r\n        }\r\n\r\n        <div id=\"wrapper\">\r\n          <uui-input\r\n            class=\"element\"\r\n            ?readonly=${true}\r\n            @input=${this.#onValueChange}\r\n            .value=${this.value || \"\"}\r\n          >\r\n            <div slot=\"append\">\r\n              <uui-button @click=${this.#onClearValue} title=\"Clear value\">\r\n                <uui-icon style=\"font-size: 40px;\">\r\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-x\"><path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/></svg>\r\n                </uui-icon>\r\n              </uui-button>\r\n            </div>\r\n          </uui-input>\r\n        </div>\r\n        `;\r\n    }\r\n\r\n    static styles = [\r\n      css`\r\n        #result-wrapper {\r\n          border: solid 1px #999999;\r\n          position: absolute;\r\n          z-index: 9999;\r\n        }\r\n        .element {\r\n          width: 100%;\r\n          margin-bottom: 10px;\r\n        }\r\n        .result {\r\n          cursor: pointer;\r\n        }\r\n        .result:hover {\r\n          color: var(--uui-color-interactive-emphasis);\r\n        }\r\n      `,\r\n    ];\r\n}\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'enterspeed-query-picker-property-editor-ui': EnterspeedQueryPickerPropertyEditorUIElement;\r\n    }\r\n}"],"names":["_EnterspeedQueryPickerPropertyEditorUIElement_instances","onQuery_fn","onClickResult_fn","onClearValue_fn","onclickOutsideResult_fn","onValueChange_fn","dispatchChangeEvent_fn","EnterspeedQueryPickerPropertyEditorUIElement","UmbElementMixin","LitElement","__privateAdd","UMB_MODAL_MANAGER_CONTEXT","instance","UMB_NOTIFICATION_CONTEXT","__privateMethod","config","html","result","event","query","content","_a","UmbPropertyValueChangeEvent","css","__decorateClass","property","state","customElement"],"mappings":"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"}